<div class="products-container">
	<mat-card class="filter-card">
		<mat-card-content>
			<form [formGroup]="filterForm" class="filter-form">
				<div class="row">
					<mat-form-field appearance="outline" class="col-12 col-md-6">
						<mat-label>Nome do Produto</mat-label>
						<input matInput formControlName="title" placeholder="Digite o nome do produto" />
						<mat-icon matSuffix>search</mat-icon>
					</mat-form-field>

					<mat-form-field appearance="outline" class="col-12 col-md-6">
						<mat-label>Categoria</mat-label>
						<mat-select formControlName="category">
							<mat-option value="">Todas as categorias</mat-option>
							@for (category of categories(); track category) {
								<mat-option [value]="category">{{ category }}</mat-option>
							}
						</mat-select>
					</mat-form-field>
				</div>

				<div class="row d-flex justify-content-end">
					<mat-form-field appearance="outline" class="col-12 col-md-6">
						<mat-label>Preço Mínimo</mat-label>
						<input matInput type="number" formControlName="minPrice" placeholder="0,00" />
						<span matPrefix>R$ </span>
					</mat-form-field>

					<mat-form-field appearance="outline" class="col-12 col-md-6">
						<mat-label>Preço Máximo</mat-label>
						<input matInput type="number" formControlName="maxPrice" placeholder="999,99" />
						<span matPrefix>R$ </span>
					</mat-form-field>

					<button
						mat-raised-button
						color="warn"
						type="button"
						(click)="clearFilters()"
						class="col-12 col-md-3 clear-btn"
					>
						<mat-icon>clear</mat-icon>
						Limpar
					</button>
				</div>
			</form>
		</mat-card-content>
	</mat-card>

	<mat-card class="products-card my-4">
		<mat-card-header class="mb-3">
			<mat-card-title class="products-header">
				<div class="header-left">
					<mat-icon>inventory_2</mat-icon>
					<span>Gerenciar Produtos</span>
					<span class="product-count">({{ totalCount() }} produtos)</span>
				</div>
				<button mat-raised-button color="primary" (click)="createProduct()" class="create-btn">
					<mat-icon>add</mat-icon>
					Novo Produto
				</button>
			</mat-card-title>
		</mat-card-header>

		<mat-card-content>
			@if (!products() || products().length === 0) {
				<div class="empty-state">
					<mat-icon>inventory_2</mat-icon>
					<h3>Nenhum produto encontrado</h3>
					<p>Não há produtos cadastrados ou que atendam aos filtros aplicados.</p>
					<button mat-raised-button color="primary" (click)="createProduct()">
						<mat-icon>add</mat-icon>
						Cadastrar Primeiro Produto
					</button>
				</div>
			} @else {
				<div class="products-grid">
					@for (product of products(); track product.id) {
						<div class="product-card">
							<div class="product-card-header">
								<div class="product-image">
									<img width="80" height="80" [ngSrc]="product.image" [alt]="product.title" />
								</div>
								<div class="product-info">
									<div class="product-category-chip">
										<mat-chip class="category-chip">
											<mat-icon matChipAvatar>category</mat-icon>
											{{ product.category }}
										</mat-chip>
									</div>
									<h3 class="product-title">{{ product.title }}</h3>
								</div>
								<div class="product-actions">
									<button mat-icon-button color="primary" (click)="editProduct(product)" matTooltip="Editar produto">
										<mat-icon>edit</mat-icon>
									</button>
									<button mat-icon-button color="warn" (click)="deleteProduct(product)" matTooltip="Excluir produto">
										<mat-icon>delete</mat-icon>
									</button>
								</div>
							</div>

							<div class="product-description">
								{{ product.description | slice: 0 : 120 }}{{ product.description.length > 120 ? '...' : '' }}
							</div>

							<div class="product-card-footer">
								<div class="product-price">
									<span class="price-label">Preço:</span>
									<span class="price-value">{{ formatPrice(product.price) }}</span>
								</div>

								<div class="product-rating" *ngIf="product.rating">
									<mat-chip class="rating-chip">
										<mat-icon matChipAvatar>star</mat-icon>
										{{ product.rating.rate }} ({{ product.rating.count }})
									</mat-chip>
								</div>
							</div>
						</div>
					}
				</div>

				<mat-paginator
					[length]="totalCount()"
					[pageSize]="pageSize()"
					[pageIndex]="currentPage()"
					[pageSizeOptions]="[5, 10, 25, 50]"
					(page)="onPageChange($event)"
					showFirstLastButtons
				>
				</mat-paginator>
			}
		</mat-card-content>
	</mat-card>
</div>
